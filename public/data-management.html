<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Data - Sistem Akademik</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
        }
        
        body {
            background: #f3f4f6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 2rem;
        }

        .container-main {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .card-custom {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .btn-group-action {
            gap: 5px;
        }

        .modal-header {
            background: var(--primary);
            color: white;
        }

        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }

        .form-label {
            font-weight: 600;
            color: #1f2937;
        }

        .badge-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .table th {
            background: #f9fafb;
            font-weight: 600;
            color: #6b7280;
            border-color: #e5e7eb;
        }

        .table td {
            border-color: #e5e7eb;
            vertical-align: middle;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding-left: 40px;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="d-flex justify-content-between align-items-center">
        <div style="font-size: 20px; font-weight: 700; color: var(--primary);">
            <i class="fas fa-database"></i> Manajemen Data
        </div>
        <button class="btn btn-danger btn-sm" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container-main">

    <!-- MAHASISWA SECTION -->
    <div class="card-custom">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0"><i class="fas fa-users"></i> Manajemen Mahasiswa</h5>
            <button class="btn btn-primary btn-sm" onclick="openAddMahasiswaModal()">
                <i class="fas fa-plus"></i> Tambah Mahasiswa
            </button>
        </div>

        <div class="search-box mb-3">
            <i class="fas fa-search"></i>
            <input type="text" class="form-control" id="searchMahasiswa" placeholder="Cari NIM, nama, atau email..." onkeyup="filterTable('mahasiswa')">
        </div>

        <div class="table-responsive">
            <table class="table table-hover" id="tableMahasiswa">
                <thead>
                    <tr>
                        <th>NIM</th>
                        <th>Nama</th>
                        <th>Email</th>
                        <th>Telepon</th>
                        <th>Kelas</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="mahasiswaBody">
                    <tr><td colspan="7" class="text-center py-4"><div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- INSTRUKTUR SECTION -->
    <div class="card-custom">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0"><i class="fas fa-chalkboard-user"></i> Manajemen Instruktur</h5>
            <button class="btn btn-primary btn-sm" onclick="openAddInstrukturModal()">
                <i class="fas fa-plus"></i> Tambah Instruktur
            </button>
        </div>

        <div class="search-box mb-3">
            <i class="fas fa-search"></i>
            <input type="text" class="form-control" id="searchInstruktur" placeholder="Cari NIP, nama, atau email..." onkeyup="filterTable('instruktur')">
        </div>

        <div class="table-responsive">
            <table class="table table-hover" id="tableInstruktur">
                <thead>
                    <tr>
                        <th>NIP</th>
                        <th>Nama</th>
                        <th>Email</th>
                        <th>Telepon</th>
                        <th>Spesialisasi</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="instrukturBody">
                    <tr><td colspan="7" class="text-center py-4"><div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- KELAS SECTION -->
    <div class="card-custom">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0"><i class="fas fa-building"></i> Manajemen Kelas</h5>
            <button class="btn btn-primary btn-sm" onclick="openAddKelasModal()">
                <i class="fas fa-plus"></i> Tambah Kelas
            </button>
        </div>

        <div class="search-box mb-3">
            <i class="fas fa-search"></i>
            <input type="text" class="form-control" id="searchKelas" placeholder="Cari kode atau nama kelas..." onkeyup="filterTable('kelas')">
        </div>

        <div class="table-responsive">
            <table class="table table-hover" id="tableKelas">
                <thead>
                    <tr>
                        <th>Kode</th>
                        <th>Nama Kelas</th>
                        <th>Tahun</th>
                        <th>Maks Siswa</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="kelasBody">
                    <tr><td colspan="6" class="text-center py-4"><div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- MODAL: ADD/EDIT MAHASISWA -->
<div class="modal fade" id="modalMahasiswa" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus"></i> <span id="modalMahasiswaTitle">Tambah Mahasiswa</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formMahasiswa">
                    <div class="mb-3">
                        <label class="form-label">NIM *</label>
                        <input type="text" class="form-control" id="mahasiswaNim" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nama *</label>
                        <input type="text" class="form-control" id="mahasiswaNama" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" id="mahasiswaEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Telepon</label>
                        <input type="tel" class="form-control" id="mahasiswaTelepon">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Alamat</label>
                        <textarea class="form-control" id="mahasiswaAlamat" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Kelas *</label>
                        <select class="form-control" id="mahasiswaKelas" required>
                            <option value="">- Pilih Kelas -</option>
                            <option value="1">TI-2A</option>
                            <option value="2">TI-2B</option>
                            <option value="3">TI-2C</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="mahasiswaStatus">
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveMahasiswa()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL: ADD/EDIT INSTRUKTUR -->
<div class="modal fade" id="modalInstruktur" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus"></i> <span id="modalInstrukturTitle">Tambah Instruktur</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formInstruktur">
                    <div class="mb-3">
                        <label class="form-label">NIP *</label>
                        <input type="text" class="form-control" id="instrukturNip" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nama *</label>
                        <input type="text" class="form-control" id="instrukturNama" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" id="instrukturEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Telepon</label>
                        <input type="tel" class="form-control" id="instrukturTelepon">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Spesialisasi</label>
                        <input type="text" class="form-control" id="instrukturSpesialisasi" placeholder="e.g. Data Science">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="instrukturStatus">
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveInstruktur()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL: ADD/EDIT KELAS -->
<div class="modal fade" id="modalKelas" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-building"></i> <span id="modalKelasTitle">Tambah Kelas</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formKelas">
                    <div class="mb-3">
                        <label class="form-label">Kode Kelas *</label>
                        <input type="text" class="form-control" id="kelascode" placeholder="e.g. TI-2A" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nama Kelas *</label>
                        <input type="text" class="form-control" id="kelasNama" placeholder="e.g. Teknik Informatika 2A" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="kelasDeskripsi" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tahun Akademik *</label>
                        <input type="text" class="form-control" id="kelasTahun" placeholder="e.g. 2024" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Maksimal Siswa *</label>
                        <input type="number" class="form-control" id="kelasMaksimal" value="40" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="kelasStatus">
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveKelas()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_BASE = 'http://127.0.0.1/laravel-starter/public/api';
let modals = {
    mahasiswa: null,
    instruktur: null,
    kelas: null
};

document.addEventListener('DOMContentLoaded', function() {
    modals.mahasiswa = new bootstrap.Modal(document.getElementById('modalMahasiswa'));
    modals.instruktur = new bootstrap.Modal(document.getElementById('modalInstruktur'));
    modals.kelas = new bootstrap.Modal(document.getElementById('modalKelas'));
    
    loadAllData();
});

async function loadAllData() {
    const token = localStorage.getItem('auth_token');
    if (!token) {
        window.location.href = 'login.html';
        return;
    }

    await loadMahasiswa(token);
    await loadInstruktur(token);
    await loadKelas(token);
}

async function loadMahasiswa(token) {
    try {
        const response = await fetch(`${API_BASE}/mahasiswa`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const { data } = await response.json();
        const tbody = document.getElementById('mahasiswaBody');
        
        tbody.innerHTML = data.map(m => `
            <tr>
                <td>${m.nim || '-'}</td>
                <td>${m.name || '-'}</td>
                <td>${m.email || '-'}</td>
                <td>${m.phone || '-'}</td>
                <td>Kelas ${m.kelas_id || '-'}</td>
                <td><span class="badge-status status-active">${m.status || 'active'}</span></td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="editMahasiswa(${m.id})" title="Edit"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-danger" onclick="deleteMahasiswa(${m.id})" title="Hapus"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        console.error('Error loading mahasiswa:', error);
    }
}

async function loadInstruktur(token) {
    try {
        const response = await fetch(`${API_BASE}/instruktur`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const { data } = await response.json();
        const tbody = document.getElementById('instrukturBody');
        
        tbody.innerHTML = data.map(i => `
            <tr>
                <td>${i.nip || '-'}</td>
                <td>${i.name || '-'}</td>
                <td>${i.email || '-'}</td>
                <td>${i.phone || '-'}</td>
                <td>${i.specialization || '-'}</td>
                <td><span class="badge-status status-active">${i.status || 'active'}</span></td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="editInstruktur(${i.id})" title="Edit"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-danger" onclick="deleteInstruktur(${i.id})" title="Hapus"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        console.error('Error loading instruktur:', error);
    }
}

async function loadKelas(token) {
    try {
        const response = await fetch(`${API_BASE}/kelas`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const { data } = await response.json();
        const tbody = document.getElementById('kelasBody');
        
        tbody.innerHTML = data.map(k => `
            <tr>
                <td>${k.code || '-'}</td>
                <td>${k.name || '-'}</td>
                <td>${k.year || '-'}</td>
                <td>${k.max_students || '-'}</td>
                <td><span class="badge-status status-active">${k.status || 'active'}</span></td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="editKelas(${k.id})" title="Edit"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-danger" onclick="deleteKelas(${k.id})" title="Hapus"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        console.error('Error loading kelas:', error);
    }
}

function openAddMahasiswaModal() {
    document.getElementById('formMahasiswa').reset();
    document.getElementById('modalMahasiswaTitle').textContent = 'Tambah Mahasiswa';
    modals.mahasiswa.show();
}

function openAddInstrukturModal() {
    document.getElementById('formInstruktur').reset();
    document.getElementById('modalInstrukturTitle').textContent = 'Tambah Instruktur';
    modals.instruktur.show();
}

function openAddKelasModal() {
    document.getElementById('formKelas').reset();
    document.getElementById('modalKelasTitle').textContent = 'Tambah Kelas';
    modals.kelas.show();
}

async function saveMahasiswa() {
    const token = localStorage.getItem('auth_token');
    const data = {
        nim: document.getElementById('mahasiswaNim').value,
        name: document.getElementById('mahasiswaNama').value,
        email: document.getElementById('mahasiswaEmail').value,
        phone: document.getElementById('mahasiswaTelepon').value,
        address: document.getElementById('mahasiswaAlamat').value,
        kelas_id: document.getElementById('mahasiswaKelas').value,
        status: document.getElementById('mahasiswaStatus').value
    };

    try {
        const response = await fetch(`${API_BASE}/mahasiswa`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            alert('Mahasiswa berhasil ditambahkan!');
            modals.mahasiswa.hide();
            loadMahasiswa(token);
        } else {
            const error = await response.json();
            alert('Error: ' + error.message);
        }
    } catch (error) {
        console.error('Error saving mahasiswa:', error);
        alert('Gagal menyimpan mahasiswa');
    }
}

async function saveInstruktur() {
    const token = localStorage.getItem('auth_token');
    const data = {
        nip: document.getElementById('instrukturNip').value,
        name: document.getElementById('instrukturNama').value,
        email: document.getElementById('instrukturEmail').value,
        phone: document.getElementById('instrukturTelepon').value,
        specialization: document.getElementById('instrukturSpesialisasi').value,
        status: document.getElementById('instrukturStatus').value
    };

    try {
        const response = await fetch(`${API_BASE}/instruktur`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            alert('Instruktur berhasil ditambahkan!');
            modals.instruktur.hide();
            loadInstruktur(token);
        } else {
            const error = await response.json();
            alert('Error: ' + error.message);
        }
    } catch (error) {
        console.error('Error saving instruktur:', error);
        alert('Gagal menyimpan instruktur');
    }
}

async function saveKelas() {
    const token = localStorage.getItem('auth_token');
    const data = {
        code: document.getElementById('kelascode').value,
        name: document.getElementById('kelasNama').value,
        description: document.getElementById('kelasDeskripsi').value,
        year: document.getElementById('kelasTahun').value,
        max_students: document.getElementById('kelasMaksimal').value,
        status: document.getElementById('kelasStatus').value
    };

    try {
        const response = await fetch(`${API_BASE}/kelas`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            alert('Kelas berhasil ditambahkan!');
            modals.kelas.hide();
            loadKelas(token);
        } else {
            const error = await response.json();
            alert('Error: ' + error.message);
        }
    } catch (error) {
        console.error('Error saving kelas:', error);
        alert('Gagal menyimpan kelas');
    }
}

async function deleteMahasiswa(id) {
    if (!confirm('Hapus mahasiswa ini?')) return;
    
    const token = localStorage.getItem('auth_token');
    try {
        const response = await fetch(`${API_BASE}/mahasiswa/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });

        if (response.ok) {
            alert('Mahasiswa berhasil dihapus!');
            loadMahasiswa(token);
        }
    } catch (error) {
        console.error('Error deleting mahasiswa:', error);
    }
}

async function deleteInstruktur(id) {
    if (!confirm('Hapus instruktur ini?')) return;
    
    const token = localStorage.getItem('auth_token');
    try {
        const response = await fetch(`${API_BASE}/instruktur/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });

        if (response.ok) {
            alert('Instruktur berhasil dihapus!');
            loadInstruktur(token);
        }
    } catch (error) {
        console.error('Error deleting instruktur:', error);
    }
}

async function deleteKelas(id) {
    if (!confirm('Hapus kelas ini?')) return;
    
    const token = localStorage.getItem('auth_token');
    try {
        const response = await fetch(`${API_BASE}/kelas/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });

        if (response.ok) {
            alert('Kelas berhasil dihapus!');
            loadKelas(token);
        }
    } catch (error) {
        console.error('Error deleting kelas:', error);
    }
}

function editMahasiswa(id) {
    alert('Fitur edit akan tersedia segera');
}

function editInstruktur(id) {
    alert('Fitur edit akan tersedia segera');
}

function editKelas(id) {
    alert('Fitur edit akan tersedia segera');
}

function filterTable(type) {
    const input = document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`);
    const filter = input.value.toLowerCase();
    const table = document.getElementById(`table${type.charAt(0).toUpperCase() + type.slice(1)}`);
    const rows = table.querySelectorAll('tbody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
}

function logout() {
    if (confirm('Logout?')) {
        localStorage.removeItem('auth_token');
        window.location.href = 'login.html';
    }
}
</script>

</body>
</html>
